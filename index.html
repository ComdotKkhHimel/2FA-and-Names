<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reliable IP Monitor System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/roboto@3.3.1/400.css" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', sans-serif; background: #f7fafc; }
    .label { font-weight: 600; color: #374151; }
    .diagnostic-ok { color: #059669; }    /* Green */
    .diagnostic-fail { color: #dc2626; }  /* Red */
    .icon-box { width:28px; height:28px;}
  </style>
</head>
<body class="min-h-screen flex flex-col items-center bg-gray-50">
  <div class="w-full max-w-2xl mt-8 rounded-xl shadow-xl bg-white p-6">
    <div class="flex items-center mb-4">
      <span class="icon-box text-blue-600 mr-2"><i class="fas fa-network-wired fa-2x"></i></span>
      <h1 class="text-2xl font-bold text-gray-900">IP Monitor System <span class="text-xs font-normal text-blue-700 bg-blue-100 px-2 py-1 rounded ml-2">Reliable Version</span></h1>
    </div>
    <p class="mb-6 text-gray-600">Accurately monitor your public IP, location, and system data with robust diagnostics and error reporting.</p>
    
    <!-- Status/Diagnostic Section -->
    <div id="diagnostic" class="mb-6 p-4 bg-gray-100 rounded-md text-sm border border-gray-200">
      <div class="mb-2 font-semibold text-gray-800 flex items-center"><i class="fas fa-stethoscope text-blue-500 mr-2"></i> System Diagnostics</div>
      <ul id="diag-list" class="pl-2 space-y-1">
        <li id="diag-ipify"><i class="fas fa-spinner fa-spin text-gray-400"></i> Checking primary IP API (<span class='font-mono'>ipify.org</span>)...</li>
        <li id="diag-ipapi"><i class="fas fa-spinner fa-spin text-gray-400"></i> Checking geo API (<span class='font-mono'>ipapi.co</span>)...</li>
        <li id="diag-device"><i class="fas fa-spinner fa-spin text-gray-400"></i> Gathering device info...</li>
      </ul>
      <div id="diag-summary" class="mt-2 text-xs text-gray-800 hidden"></div>
    </div>

    <!-- Information Display Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- IP / Location -->
      <div>
        <div class="text-lg font-semibold text-gray-800 mb-2 flex items-center">
          <i class="fas fa-globe text-blue-500 mr-2"></i> Network Info
        </div>
        <div class="space-y-2 pl-2">
          <div><span class="label">Public IP:</span> <span id="ip" class="font-mono text-gray-700">Loading…</span></div>
          <div><span class="label">IP Protocol:</span> <span id="protocol" class="font-mono text-gray-700">Detecting…</span></div>
          <div><span class="label">City:</span> <span id="city" class="text-gray-700">–</span></div>
          <div><span class="label">Region:</span> <span id="region" class="text-gray-700">–</span></div>
          <div><span class="label">Country:</span> <span id="country" class="text-gray-700">–</span></div>
          <div><span class="label">Timezone:</span> <span id="timezone" class="text-gray-700">–</span></div>
          <div><span class="label">ISP:</span> <span id="org" class="text-gray-700">–</span></div>
        </div>
      </div>

      <!-- Device Info -->
      <div>
        <div class="text-lg font-semibold text-gray-800 mb-2 flex items-center">
          <i class="fas fa-desktop text-green-500 mr-2"></i> Device &amp; Browser
        </div>
        <div class="space-y-2 pl-2">
          <div><span class="label">Device Type:</span> <span id="device-type" class="text-gray-700">Detecting…</span></div>
          <div><span class="label">OS:</span> <span id="os" class="text-gray-700">–</span></div>
          <div><span class="label">Browser:</span> <span id="browser" class="text-gray-700">–</span></div>
          <div><span class="label">User Agent:</span> <span id="useragent" class="text-gray-700 text-xs break-all"></span></div>
          <div><span class="label">Screen:</span> <span id="screen-size" class="text-gray-700">–</span></div>
        </div>
      </div>
    </div>

    <!-- Manual Refresh -->
    <div class="flex justify-end mt-8">
      <button id="refresh-btn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded shadow hover:bg-blue-700 transition">
        <i class="fas fa-sync-alt mr-1"></i> Refresh
      </button>
    </div>
  </div>

  <footer class="text-center mt-10 text-gray-500 text-sm">
    Reliable IP Monitor System &copy; 2024 | Uses <a href="https://ipify.org/" class="text-blue-600 underline" target="_blank" rel="noopener">ipify.org</a> and <a href="https://ipapi.co/" class="text-blue-600 underline" target="_blank" rel="noopener">ipapi.co</a>
  </footer>

<script>
function simpleDeviceType() {
  let ua = navigator.userAgent.toLowerCase();
  if(/mobile|android|touch|webos|hpwos/i.test(ua)) return 'Mobile';
  if(/tablet|ipad|playbook|silk/i.test(ua)) return 'Tablet';
  return 'Desktop';
}
function simpleBrowser() {
  let ua = navigator.userAgent;
  if(ua.indexOf("Firefox")>-1) return "Firefox";
  if(ua.indexOf("Edg")>-1) return "Microsoft Edge";
  if(ua.indexOf("OPR")>-1 || ua.indexOf("Opera")>-1) return "Opera";
  if(ua.indexOf("Chrome")>-1) return "Chrome";
  if(ua.indexOf("Safari")>-1) return "Safari";
  return "Unknown";
}
function simpleOS() {
  let ua = navigator.userAgent;
  if(/Windows NT 10/.test(ua)) return "Windows 10";
  if(/Windows NT 6/.test(ua)) return "Windows Vista/7/8";
  if(/Mac OS X 10[._]\d+/.test(ua)) return "Mac OS X";
  if(/Android/.test(ua)) return "Android";
  if(/Linux/.test(ua)) return "Linux";
  if(/iPhone|iPad|iPod/.test(ua)) return "iOS";
  return "Unknown";
}

function updateDeviceInfo() {
  $("#device-type").text(simpleDeviceType());
  $("#os").text(simpleOS());
  $("#browser").text(simpleBrowser());
  $("#useragent").text(navigator.userAgent);
  $("#screen-size").text(`${window.screen.width} x ${window.screen.height}`);
  // Diagnostic
  $("#diag-device").html('<i class="fas fa-check-circle diagnostic-ok"></i> Device info read <span class="diagnostic-ok">(OK)</span>');
}

// IP and Geo functions
let diagResults = {ipify:false, ipapi:false, device:true};

function setDiag(id, status, message) {
  let icons = {
    ok: '<i class="fas fa-check-circle diagnostic-ok"></i>',
    fail: '<i class="fas fa-times-circle diagnostic-fail"></i>',
    loading: '<i class="fas fa-spinner fa-spin text-gray-400"></i>',
  };
  let el = $(id);
  if(status === 'ok') {
    el.html(`${icons.ok} ${message} <span class="diagnostic-ok">(OK)</span>`);
  } else if(status==='fail') {
    el.html(`${icons.fail} ${message} <span class="diagnostic-fail">(Fail)</span>`);
  } else {
    el.html(`${icons.loading} ${message}`);
  }
}

// API requests, fallbacks, diagnostics
function updateIPInfo() {
  diagResults = {ipify:false, ipapi:false, device:true};
  setDiag("#diag-ipify", "loading", "Checking primary IP API (<span class='font-mono'>ipify.org</span>)...");
  setDiag("#diag-ipapi", "loading", "Checking geo API (<span class='font-mono'>ipapi.co</span>)...");

  $("#ip").text("Loading…");
  $("#protocol").text("Detecting…");
  $("#city, #region, #country, #timezone, #org").text("–");

  // 1. Get Public IP from ipify.org
  $.getJSON("https://api.ipify.org?format=json")
    .done(function(data) {
      if(data && data.ip) {
        diagResults.ipify = true;
        $("#ip").text(data.ip);
        // Detect IPv4 or IPv6
        if(data.ip.indexOf(":") > -1) $("#protocol").text("IPv6");
        else $("#protocol").text("IPv4");
        setDiag("#diag-ipify", "ok", "Primary IP API (<span class='font-mono'>ipify.org</span>) responded.");
        // Then get geo info from ipapi.co
        $.getJSON("https://ipapi.co/" + data.ip + "/json/")
          .done(function(gdata){
            diagResults.ipapi = true;
            $("#city").text(gdata.city||'–');
            $("#region").text(gdata.region||'–');
            $("#country").text(gdata.country_name||'–');
            $("#timezone").text(gdata.timezone||'–');
            $("#org").text(gdata.org||gdata.org_name||'–');
            setDiag("#diag-ipapi", "ok", "Geo API (<span class='font-mono'>ipapi.co</span>) responded.");
            diagSummary();
          })
          .fail(function(){
            diagResults.ipapi = false;
            setDiag("#diag-ipapi", "fail", "Geo API (<span class='font-mono'>ipapi.co</span>) unavailable.");
            diagSummary();
          });
      } else {
        diagResults.ipify = false;
        setDiag("#diag-ipify", "fail", "Primary IP API (<span class='font-mono'>ipify.org</span>) response invalid.");
        fallbackIP();
        diagSummary();
      }
    })
    .fail(function(){
      diagResults.ipify = false;
      setDiag("#diag-ipify", "fail", "Primary IP API (<span class='font-mono'>ipify.org</span>) unreachable.");
      fallbackIP();
      diagSummary();
    });
}

function fallbackIP() {
  // Use ipapi.co's own /ip/ endpoint as a fallback
  $.getJSON("https://ipapi.co/json/")
    .done(function(gdata){
      diagResults.ipapi = !!gdata && !!gdata.ip;
      $("#ip").text(gdata.ip||"Unavailable");
      if(gdata.ip && gdata.ip.indexOf(":") > -1)
        $("#protocol").text("IPv6");
      else
        $("#protocol").text("IPv4");
      $("#city").text(gdata.city||'–');
      $("#region").text(gdata.region||'–');
      $("#country").text(gdata.country_name||'–');
      $("#timezone").text(gdata.timezone||'–');
      $("#org").text(gdata.org||gdata.org_name||'–');
      setDiag("#diag-ipapi", diagResults.ipapi ? "ok" : "fail", "Geo API (<span class='font-mono'>ipapi.co</span>) " + (diagResults.ipapi ? "responded." : "unavailable."));
      diagSummary();
    })
    .fail(function(){
      setDiag("#diag-ipapi", "fail", "Geo API (<span class='font-mono'>ipapi.co</span>) unreachable.");
      $("#ip").text("Unavailable");
      diagResults.ipapi = false;
      diagSummary();
    });
}

function diagSummary() {
  let ok = [];
  let fail = [];
  if(diagResults.ipify) ok.push('Public IP');
  else fail.push('Public IP');
  if(diagResults.ipapi) ok.push('Geolocation');
  else fail.push('Geolocation');
  if(diagResults.device) ok.push('Device Info');
  else fail.push('Device Info');
  let $sum = $("#diag-summary");
  if(fail.length===0) {
    $sum.removeClass('text-red-600').addClass('text-green-700').text("✔️ All systems operational.");
    $sum.show();
  } else {
    $sum.removeClass('text-green-700').addClass('text-red-600');
    $sum.html("<span class='font-semibold'>Notice:</span> The following modules could not load: <span class='font-semibold'>" + fail.join(', ') + "</span>. Check your internet connection, or API provider status.");
    $sum.show();
  }
}

$(function(){
  updateDeviceInfo();
  updateIPInfo();
  $("#refresh-btn").click(function(){
    updateDeviceInfo();
    updateIPInfo();
  });
});
</script>
</body>
</html>

